# Do not edit this file
# Editing this file manually might break Capima System
# If you think there is a bug, contact us at capima-bug@nntoan.com

server_name             APPDOMAINS;
server_tokens           off;
error_log               HOMEDIR/logs/nginx/APPNAME_error.log;
access_log              HOMEDIR/logs/nginx/APPNAME_access.log main buffer=16k;
access_log              /var/log/nginx-rc/APPNAME_traffic.log traffic;

client_max_body_size    256m;

include /etc/nginx-rc/conf.d/APPNAME.d/headers.conf;

root HOMEDIR/webapps/APPNAME/PUBLICPATH;
index index.php index.html index.htm;

include /etc/nginx-rc/extra.d/APPNAME.location.main-before.*.conf;

location ~ /.well-known/acme-challenge {
    allow all;
    log_not_found off;
    root  /opt/Capima/letsencrypt;
}

location / {
    include /etc/nginx-rc/extra.d/APPNAME.location.root.*.conf;
    try_files $uri $uri/ /index.php$is_args$args;
}

location ~ /\. {
    deny all;
    access_log off;
    log_not_found off;
}

location = /favicon.ico {
    log_not_found off;
}

location ~ .(ico|css|gif|jpe?g|png|gz|zip|flv|rar|wmv|avi|css|js|swf|png|htc|mpeg|mpg|txt|otf|ttf|eot|woff|woff2|svg)$ {
    expires     1M;
    include /etc/nginx-rc/conf.d/APPNAME.d/headers.conf;
    add_header  Cache-Control "public";
    include /etc/nginx-rc/extra.d/APPNAME.location.static.*.conf;
    try_files $uri $uri/ /index.php$is_args$args;
}

location ~ .(html)$ {
    expires     24h;
    include /etc/nginx-rc/conf.d/APPNAME.d/headers.conf;
    add_header  Cache-Control "public";
    include /etc/nginx-rc/extra.d/APPNAME.location.html.*.conf;
    try_files $uri $uri/ /index.php$is_args$args;
}

include /etc/nginx-rc/extra.d/APPNAME.location.main.*.conf;

location ~ \.php$ {
    include /etc/nginx-rc/conf.d/APPNAME.d/proxy.conf;
}